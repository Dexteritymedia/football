{% extends 'app/base.html' %}

{% block meta_description %}
<meta content="{{team.name}} Premier League Goals Stats in 2024: Detailed Analysis and Insights" name="title">
<meta content="Explore {{team.name}}'s goal scoring stats in the Premier League for the 2024 season. Get detail insights into top scorers, match performance, and historical data" name="description">
{% endblock meta_description %}

{% block content %}

<div class="p-5">
{% for season in seasons %}
<a href="{% url 'goal-analysis-page' team.name team.slug season.name %}">{{season.name}} </a> |
{% endfor %}
</div>


<div class="col mt-3">
<h1>{{team_data.season.name}} {{team.name}} {% for season in season %} {{season}} {% endfor %} Goals breakdown</h1>



<h2 class="mt-3">Overview of {{team.name}}'s Goal Scoring Performance</h2>


<div class="row mt-5">
	<div class="col-4">
		<img src="{{ team.logo_url }}" width="100px" height="100px" class="img-fluid" alt="{{ team.name }}">
	</div>
	
<div class="col-8">
{% for key, values in goals_scored.items %}
{% if key == 'gs' %}
<h3>Total goals scored: {{values}}</h3>
{% endif %}
{% if key == 'gc' %}
<h3>Total goals conceded: {{values}}</h3>
{% endif %}
{% endfor %}

<p></p>

{% for key, values in home_goals_scored.items %}
{% if key == 'gs' %}
<h3>Home goals scored: {{values}}</h3>
{% endif %}
{% if key == 'gc' %}
<h3>Home goals conceded: {{values}}</h3>
{% endif %}
{% endfor %}

<p></p>

{% for key, values in away_goals_scored.items %}
{% if key == 'gs' %}
<h3>Away goals scored: {{values}}</h3>
{% endif %}
{% if key == 'gc' %}
<h3>Away goals conceded: {{values}}</h3>
{% endif %}
{% endfor %}

<p></p>

{% for key, values in clean_sheet.items %}
{% if key == 'gc' %}
<h3>Total clean sheet: {{values}}</h3>
{% endif %}
{% endfor %}

<p></p>

{% for key, values in max_min_goal.items %}
{% if key == 'gs' %}
<h3>Most goal scored in a single match: {{values}}</h3>
{% endif %}
{% if key == 'gc' %}
<h3>Most goal conceded in a single match: {{values}}</h3>
{% endif %}
{% endfor %}
</div>

</div>

</div>


{% if prev_seasons_results %}
<h3 class="mt-3">{{team.name}} Historical Goal Scoring Data in the last 5 Years</h3>

{% for seasons in prev_seasons_results %}
	{% for season in seasons %}
	<div class="col-4">
		{{season.name}}
	</div>
	<div class="col-8">
		<p>{% for s, g in season.items %} 
			{% if s == 'gs' %} 
			<p>Goals scored:  {{g}}</p>
			{% endif %}
			{% if s == 'gc' %} 
			<p>Goals conceded:  {{g}}</p>
			{% endif %}
		{% endfor %}</p>
	</div>
	{% endfor %} 
{% endfor %}

{% endif %}


{% if group_by_team_value %}

<div class="mt-3">
	<h1 class="text-center">{{team.name}} All Match Performance Analysis</h1>
	<div class="accordion accordion-flush" id="accordionFlushExample">
	{% for key, values in group_by_team_value.items %}
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
        {% if key == 'L' %}
			<h1>{{values|length}} Loses </h1>
		{% elif key == 'W' %}
			<h1>{{values|length}} Wins </h1>
		{% elif key == 'D' %}
			<h1>{{values|length}} Draws </h1>
		{% else %}
			<h1>{{values|length}}</h1>
		{% endif %}
      </button>
    </h2>
    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
	  <div class="table-responsive mt-3">
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<th scope="col">Club</th>
					<th scope="col">Scoreline</th>
					<th scope="col">MatchWeek</th>
				</tr>
			</thead>
				{% for v in values %} 
				<tbody>
					<tr class="">
					<td>{% comment %}<img src="{{ v.club_against.logo_url }}" width="50px" height="50px" class="img-fluid" alt="{{ v.club_against }}">{% endcomment %} {{v.club_against}}</td>
					<td>{{ v.goals_scored }} - {{ v.goals_against }}</td>
					{% if v.matchweek == 0 %}
						<td>{{ v.tournament }}</td>
					{% else %}
						<td>MatchWeek: {{ v.matchweek }}</td>
					{% endif %}
					</tr>
				</tbody>
				{% endfor %}
		</table>
	</div>
    </div>
  </div>
  {% endfor %}
</div>
</div>

{% else %}
	<h1 class="mt-5">No results for your search</h1>
{% endif %}



{% if group_by_team_home_games %}

<div class="mt-3">
	<h2 class="text-center">{{team.name}} Home Match Performance Analysis</h2>
	<div class="accordion accordion-flush" id="accordionFlushExample">
	{% for key, values in group_by_team_home_games.items %}
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
        {% if key == 'L' %}
			<h1>{{values|length}} Loses </h1>
		{% elif key == 'W' %}
			<h1>{{values|length}} Wins </h1>
		{% elif key == 'D' %}
			<h1>{{values|length}} Draws </h1>
		{% else %}
			<h1>{{values|length}}</h1>
		{% endif %}
      </button>
    </h2>
    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
	  <div class="table-responsive mt-3">
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<th scope="col">Club</th>
					<th scope="col">Scoreline</th>
					<th scope="col">MatchWeek</th>
				</tr>
			</thead>
				{% for v in values %} 
				<tbody>
					<tr class="">
					<td>{% comment %}<img src="{{ v.club_against.logo_url }}" width="50px" height="50px" class="img-fluid" alt="{{ v.club_against }}">{% endcomment %} {{v.club_against}}</td>
					<td>{{ v.goals_scored }} - {{ v.goals_against }}</td>
					{% if v.matchweek == 0 %}
						<td>{{ v.tournament }}</td>
					{% else %}
						<td>MatchWeek: {{ v.matchweek }}</td>
					{% endif %}
					</tr>
				</tbody>
				{% endfor %}
		</table>
	</div>
    </div>
  </div>
  {% endfor %}
</div>
</div>

{% else %}
	<h1 class="mt-5">No results for your search</h1>
{% endif %}


{% if group_by_team_away_games %}

<div class="mt-3">
	<h2 class="text-center">{{team.name}} Away Match Performance Analysis</h2>
	<div class="accordion accordion-flush" id="accordionFlushExample">
	{% for key, values in group_by_team_away_games.items %}
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
        {% if key == 'L' %}
			<h1>{{values|length}} Loses </h1>
		{% elif key == 'W' %}
			<h1>{{values|length}} Wins </h1>
		{% elif key == 'D' %}
			<h1>{{values|length}} Draws </h1>
		{% else %}
			<h1>{{values|length}}</h1>
		{% endif %}
      </button>
    </h2>
    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
	  <div class="table-responsive mt-3">
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<th scope="col">Club</th>
					<th scope="col">Scoreline</th>
					<th scope="col">MatchWeek</th>
				</tr>
			</thead>
				{% for v in values %} 
				<tbody>
					<tr class="">
					<td>{% comment %}<img src="{{ v.club_against.logo_url }}" width="50px" height="50px" class="img-fluid" alt="{{ v.club_against }}">{% endcomment %} {{v.club_against}}</td>
					<td>{{ v.goals_scored }} - {{ v.goals_against }}</td>
					{% if v.matchweek == 0 %}
						<td>{{ v.tournament }}</td>
					{% else %}
						<td>MatchWeek: {{ v.matchweek }}</td>
					{% endif %}
					</tr>
				</tbody>
				{% endfor %}
		</table>
	</div>
    </div>
  </div>
  {% endfor %}
</div>
</div>

{% else %}
	<h1 class="mt-5">No results for your search</h1>
{% endif %}


<div id="container" style="width: 75%;">
    <canvas id="goal-chart" data-url="{% url 'goal-chart' team.name %}"></canvas>
 </div>

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
  <script>

    $(function () {

      var $populationChart = $("#goal-chart");
      $.ajax({
        url: $populationChart.data("url"),
        success: function (data) {

          var ctx = $populationChart[0].getContext("2d");

          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'MatchWeek',
                backgroundColor: 'blue',
                data: data.data
              }]          
            },
            options: {
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: '{{team.name}} Cumulative Goals Scored Bar Chart'
              }
            }
          });

        }
      });

    });

  </script>

{% comment %}

{% for gd in goal_diff %}
{{gd.gd}}
{% endfor %}


<p></p>
{% for c in c_goals %}
{{c.cumbalance}}
{% endfor %}

{% for key, values in group_by_value.items %}
 {% for v in values %} <p>{{v.club_against.name}} {{v.goals_scored}}</p> {% endfor %}
{% endfor %}

{% endcomment %}

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 

{% endblock content %}